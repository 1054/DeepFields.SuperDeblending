#!/bin/bash
#

type readlink > /dev/null
type dirname > /dev/null

SMPATH=$(dirname $(dirname $(readlink -f $0)))
SMDATE=$(date +%s.$(date +%N|cut -b 1,2,3,4)) # SMDATE=$(date +%Y%m%d.%H%M%S.%N.%Z)

mkdir                                            "/tmp/sm.$SMDATE" 2>/dev/null
echo "fonts		$SMPATH/lib/sm/fonts.bin"      >  "/tmp/sm.$SMDATE/.sm"
echo "history_file	.smhist"                   >> "/tmp/sm.$SMDATE/.sm"
echo "history		80"                        >> "/tmp/sm.$SMDATE/.sm"
echo "temp_dir	/tmp/"                         >> "/tmp/sm.$SMDATE/.sm"
echo "graphcap	$SMPATH/lib/sm/graphcap"       >> "/tmp/sm.$SMDATE/.sm"
echo "+graphcap	$SMPATH/lib/sm/graphcap.local" >> "/tmp/sm.$SMDATE/.sm"
echo "filecap		$SMPATH/lib/sm/filecap"    >> "/tmp/sm.$SMDATE/.sm"
echo "termcap		$SMPATH/lib/sm/termcap"    >> "/tmp/sm.$SMDATE/.sm"
echo "help		/tmp/sm.$SMDATE/help/"         >> "/tmp/sm.$SMDATE/.sm"
echo "macro		/tmp/sm.$SMDATE/macro/"        >> "/tmp/sm.$SMDATE/.sm"
#echo "help		$SMPATH/lib/sm/help/"          >> "/tmp/sm.$SMDATE/.sm"
#echo "macro		$SMPATH/lib/sm/macro/"     >> "/tmp/sm.$SMDATE/.sm"
chmod 777                                        "/tmp/sm.$SMDATE/.sm"

ln -fs "$SMPATH/lib/sm/macro" "/tmp/sm.$SMDATE/macro" 2>/dev/null
ln -fs "$SMPATH/lib/sm/help" "/tmp/sm.$SMDATE/help" 2>/dev/null
if [[ -f $SMPATH/bin/sm ]]; then
$SMPATH/bin/sm -f "/tmp/sm.$SMDATE/.sm" $*
else
echo ""
echo "*************************************"
echo "Error! Supermongo was not installed! "
echo "*************************************"
echo ""
fi
rm -rf "/tmp/sm.$SMDATE" 2>/dev/null

