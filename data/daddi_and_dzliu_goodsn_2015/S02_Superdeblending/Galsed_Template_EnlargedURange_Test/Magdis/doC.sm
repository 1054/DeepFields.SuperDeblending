doX24	define $xname 8
		data sed_z$xname""_U$xname""_radio.txt read {ws 1 fsfr 2} set fsfr = fsfr*ws set ws=lg(ws)
        spline ws fsfr xxWS xfsfr
        set fsfr$xname = fsfr$xname>0 ? fsfr$xname : 0
doC	00	
		data sed_z8_U8_radio.txt 
		#data sed_z101_U101_radio.txt 
		read {ws 1 fsfr 2} set fsfr = fsfr*ws  set ws=lg(ws)
		set xxWS = -1,6,.01
        spline ws fsfr xxWS xfsfr
        smooth xfsfr fsfr 13
		set ws = 10**xxWS
		declare C 0
		declare C1 0
		declare C2 0
		declare C3 0
		declare Cradio 0
		set ww = {24 350 500 1160 93330 200000}
		set zz = 0.1,20,.1 foreach var zz {
			set ws_ = ws*(1+$var)
			spline ws_ fsfr ww xCC
			set C = C concat $(xCC[1]/xCC[5])
			set C1 = C1 concat $(xCC[2]/xCC[5])
			set C2 = C2 concat $(xCC[0]/xCC[1])
			set C3 = C3 concat $(xCC[0]/xCC[2])
			set Cradio = Cradio concat $(xCC[4]/xCC[5])
		}
		window -1 -2 1 2
		ticksize 0 0 -1 0
		limits zz 0 2.3 erase box 3 2 3 3 connect zz (lg(5000/C))
		ctype red connect zz (lg(5000/C1)) ctype 0
		ylabel 20cm [uJy] (for 5mJy at 350/500)
		ltype 1
		rel -1 $(lg(13.5)) draw 1e2 $(lg(13.5))
		rel -1 $(lg(7.5)) draw 1e2 $(lg(7.5))
		ltype 0
		window -1 -2 1 1
		limits zz 0 2.3 box connect zz (lg(C2/5*1000))
		ctype red connect zz (lg(C3/5*1000)) ctype 0
		ticksize 0 0 0 0
		xlabel Redshift
		ylabel 24um [uJy] (for 5mJy at 350/500)
		ltype 1
		rel -1 $(lg(20)) draw 1e2 $(lg(20))
		ltype 0
		ticksize 0 0 0 0
		window 1 1 1 1
doP	00	
		set ww = {250 350 500 200000} set FF = {5.1 6.5 7.6  0.010} set eFF = {3.2 1.2 2.3 0.0025}
		set ww = {24 350 500 200000} set FF = {0.003 7.5 7.7 0.0233} set eFF = {0.006 1.2 2.4 0.0035}
		set ww = {24 350 500 200000} set FF = {0.003 7.2 5.8 0.0149} set eFF = {0.006 1.2 2.4 0.0035}
		data sed_z8_U8_radio.txt read {ws 1 fsfr 2} set fsfr = fsfr*ws 
		declare chi2 0
		set zz=0.1,10,.1 foreach xZZ zz {
		set Xws=ws*(1+$xZZ)
		spline Xws fsfr ww xFF
		define noorm $(sum(FF*xFF/eFF**2)/sum(xFF**2/eFF**2))
		#set fsfr=fsfr*8.6/xFF[1]
		set Xfsfr=fsfr*$noorm
		set xFF = xFF*$noorm
		set chi2 = chi2 concat $(sum((FF-xFF)**2/eFF**2))
		}
		window 2 1 1 1
		goi zz (1/chi2)
		xlabel Redshift 
		ylabel chi2
		vecminmax chi2 mii maa
		set zz2 = zz if(chi2<$mii+.01) 
		stats zz2 me si ku

		ticksize -1 0 -1 0
		set Xws=ws*(1+$me)
		spline Xws fsfr ww xFF
		define noorm $(sum(FF*xFF/eFF**2)/sum(xFF**2/eFF**2))
		#set fsfr=fsfr*8.6/xFF[1]
		set Xfsfr=fsfr*$noorm
		set xFF = xFF*$noorm
		window 2 1 2 1
		limits 1 6 -3 2  box connect (lg(Xws)) (lg(Xfsfr)) 
		error_y (lg(ww)) (lg(FF)) (1/2.3*eFF/FF)
		ptype 25 3 expand 0.9 points (lg(ww)) (lg(FF))
		ticksize 0 0 0 0
		xlabel Wavelength [um]
		ylabel Flux [mJy]

		set zz2 = zz if(chi2<$mii+1) 
		vecminmax zz2 mii maa 
		echo $mii $maa
		window 1 1 1 1
last_highz	macro read doC.sm doC
		goc zz (lg(Cradio/$(Cradio[0])))
		set aa = zz if(abs(lg(Cradio/$(Cradio[0]))-.3)<.1) stats aa me si ku echo $me
		set aa = zz if(abs(lg(Cradio/$(Cradio[0]))-.5)<.1) stats aa me si ku echo $me 
		set aa = zz if(abs(lg(Cradio/$(Cradio[0]))-1)<.1) stats aa me si ku echo $me 
