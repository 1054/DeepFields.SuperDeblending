# 2015-12-14
# 2016-02-12
# This is an instruction of how to extract additional 
# sources from the residual image
# (1) run idl code to create signal image SExtractor_Signal.fits
# (2) run sex to extract additional sources
# (3) run sm to make Residual_priors_*.txt SED_predictions_*.txt coo_*.txt
#     

idl -e 'do_SExtract_Mask, FITPhoto = "../FIT_goodsn_250_Map_201601.fits", RMSPhoto = "../spire250_rms_3p6_v0_100615.fits"'

ds9 -mecube -tile mode column -lock frame wcs "../FIT_goodsn_250_Map_201601.fits" SExtractor_Signal.fits SExtractor_Noise.fits

# gedit default.sex # please check this sextractor config file to make sure everything is fine

#sex SExtractor_Signal.fits

#sex SExtractor_Signal.fits -DETECT_THRESH 1.5 # tune the detect threshold when necessary

sex SExtractor_Signal.fits -DETECT_THRESH 1.8 -DETECT_MINAREA 2

sm <<< "macro read do_sextract_result.sm go 250"

CrabTable2ds9reg SExtractor_OutputList.txt SExtractor_OutputList.ds9.reg -xy2sky SExtractor_Signal.fits

ds9 -tile mode column -lock frame wcs SExtractor_Weight.fits SExtractor_Noise.fits \
                                      SExtractor_Signal.fits   -scale limits -0.001 0.007 \
                                      SExtractor_Model.fits    -scale limits -0.001 0.007 -region load SExtractor_OutputList.ds9.reg \
                                      SExtractor_ModelRev.fits -scale limits -0.001 0.007 &


