
#########################################
#|-------------------------------------|#
#| This is an example of galfit at 250 |#
#|-------------------------------------|#
#########################################



###################################
# Prepare scripts and fits images #
###################################

cd    /home/dzliu/Data/DeepFields/daddi_and_dzliu_goodsn_2016/S02_Superdeblending_FIR/
mkdir Galfit_Band350_WithPriorSourcesDenserThanOne_WithAddSources_Pass1/
cd    Galfit_Band350_WithPriorSourcesDenserThanOne_WithAddSources_Pass1/

ln -s ../spire350_ima_4p8_v0_100615.fits 
ln -s ../spire350_rms_4p8_v0_100615.fits 
ln -s ../psf_goodsn_spire350_4p8arcsec_v0_100622.fits 

ln -s ../goFine.sm
ln -s ../goSimu.sm
ln -s ../run_simu_stats_v7.sm

cp -i ../Galsed_BeforeBand350/do_Type_FIT_WithPriorSourcesDenserThanOne/SED_predictions_350.* .
cp -i ../Galfit_Band350_WithPriorSourcesDenserThanOne/RadioOwenMIPS24_*Band250.* .
cp -i ../Galfit_Band350_WithPriorSourcesDenserThanOne/run_sextractor/Residual_priors_Band350_Trial.txt .



##########################################################
# Run galfit with input catalog but fix source positions #
##########################################################

#source ../../../../Softwares/SETUP

ln -fs ../Galfit_Band350_WithPriorSourcesDenserThanOne/spire350_ima_4p8_v0_100615_subfaintDL.fits # no need to re-run do_Galsub 350 201601 -catalog RadioOwenMIPS24_priors_dzliu_20160128_Band250.txt -sedpredict SED_predictions_350.txt

do_Galfit 350 201601 -catalog RadioOwenMIPS24_priors_dzliu_20160128_Band250.txt -sedpredict SED_predictions_350.txt -fitsname spire350_ima_4p8_v0_100615_subfaintDL.fits -catalog-add Residual_priors_Band350_Trial.txt

cd boxgalfit; do_GalfitRunqsub; cd ..

do_Galfit 350 201601 -catalog RadioOwenMIPS24_priors_dzliu_20160128_Band250.txt -sedpredict SED_predictions_350.txt -fitsname spire350_ima_4p8_v0_100615_subfaintDL.fits -catalog-add Residual_priors_Band350_Trial.txt -postparallel



#############################
# OK, the output files are: #
#############################

ls FIT_*.fits results_*

cp -r ../Galfit_Band350_WithPriorSourcesDensityOne/sim_diagram_output_v7 .

sm <<< "macro read goFine.sm R_MIPS350_E"



###############################################
# Next, check the residual image, extract     #
# additional sources from residual if needed, #
# then re-run galfit with parameter like      #
# "-catalog-add Residual_priors_350.txt".     #
###############################################

cp -r /home/dzliu/Cloud/Github/DeepFields.SuperDeblending/data/daddi_and_dzliu_goodsn_2015/S02_Superdeblending/Galfit_Template/run_sextractor_postanalysis* .

./run_sextractor_postanalysis.sh -band 350 -catalog-old Residual_priors_Band350_Trial.txt -catalog-output Residual_priors_Band350_Revised.txt -fitresults-flux results_350_201601__fluxes.txt -sedpredict SED_predictions_350.txt












